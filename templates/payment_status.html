
<!-- templates/payment_status.html -->
{% extends 'base.html' %}

{% block content %}
<h1>Payment Status</h1>

<h2>Order Details</h2>
<p>Order ID: {{ order.id }}</p>
<p>Product: {{ order.product.name }}</p>
<p>Quantity: {{ order.quantity }}</p>
<p>Total Amount: KSH {{ order.total_amount }}</p>
<p>Phone Number: {{ order.phone_number }}</p>
<p>Status: {{ order.get_status_display }}</p>
<p>Order Date: {{ order.created_at }}</p>

{% if order.status == 'pending' %}
    <p>Please complete the payment on your phone. This page will update automatically.</p>
    
    <script>
        // Auto-refresh page every 5 seconds to check payment status
        setTimeout(function() {
            location.reload();
        }, 5000);
    </script>
    
{% elif order.status == 'paid' %}
    <p>Payment successful! Your order has been confirmed.</p>
    
    {% if order.mpesatransaction %}
        <h3>Transaction Details</h3>
        <p>M-Pesa Receipt: {{ order.mpesatransaction.mpesa_receipt_number }}</p>
        <p>Transaction Date: {{ order.mpesatransaction.transaction_date }}</p>
    {% endif %}
    
{% elif order.status == 'failed' %}
    <p>Payment failed. Please try again.</p>
    <a href="{% url 'checkout' order.product.id %}">Try Again</a>
{% endif %}

<a href="{% url 'product_list' %}">Back to Products</a>

{% endblock %}